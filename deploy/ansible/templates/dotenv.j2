# =============================================================================
# Storm Cloud Server - Production Environment
# Generated by Ansible: {{ ansible_date_time.iso8601 }}
# Do not edit directly - managed by deployment
# =============================================================================

# Django Settings
SECRET_KEY={{ secret_key }}
DEBUG=False
ALLOWED_HOSTS={{ domain }},localhost,127.0.0.1

# Docker Compose
COMPOSE_PROJECT_NAME=stormcloud
WEB_PORT={{ _web_port }}

# PostgreSQL
POSTGRES_DB=stormcloud
POSTGRES_USER=stormcloud
POSTGRES_HOST=db
POSTGRES_PASSWORD={{ db_password }}

# Email Configuration
{% if email_host is defined and email_host | length > 0 %}
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST={{ email_host }}
EMAIL_PORT={{ email_port | default(587) }}
EMAIL_USE_TLS={{ email_use_tls | default(true) | string | lower }}
EMAIL_HOST_USER={{ email_user | default('') }}
EMAIL_HOST_PASSWORD={{ email_password | default('') }}
{% else %}
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
{% endif %}
DEFAULT_FROM_EMAIL={{ default_from_email | default('noreply@' ~ domain) }}

# Security (production settings)
SECURE_HSTS_SECONDS=31536000
SESSION_COOKIE_SECURE=True
CSRF_COOKIE_SECURE=True
SECURE_SSL_REDIRECT=False  # nginx handles this

# CORS - Cross-Origin Resource Sharing
# Comma-separated list of allowed origins (e.g., "https://app.example.com,https://dashboard.example.com")
# Leave empty to disable CORS (most secure, but frontend won't work)
STORMCLOUD_CORS_ORIGINS={{ _cors_origins }}

# Cookie domain for cross-subdomain session auth
# Use leading dot for all subdomains (e.g., ".example.com")
# Leave empty for single-domain setups
STORMCLOUD_COOKIE_DOMAIN={{ cookie_domain | default('') }}

# Frontend URL for email links (where users access the web UI)
STORMCLOUD_FRONTEND_URL={{ frontend_url | default('https://stormdevelopments.ca') }}

# File Upload Limits (P0-3 Security Fix)
# Maximum file size in MB (set in deploy/config.yml)
STORMCLOUD_MAX_UPLOAD_SIZE_MB={{ _max_upload_size_mb }}

# Persistent Data Paths (outside git repo to prevent data loss)
# UPLOADS_PATH: Host path mounted to /app/uploads in container
# STORMCLOUD_STORAGE_ROOT: Django setting for where files are stored (inside container)
UPLOADS_PATH=/var/stormcloud/uploads
BACKUPS_PATH=/var/stormcloud/backups
STORMCLOUD_STORAGE_ROOT=/app/uploads

# Shared/Org Storage (persistent volume for organization files)
SHARED_STORAGE_PATH=/var/stormcloud/shared
STORMCLOUD_SHARED_STORAGE_ROOT=/app/shared_storage

# Encryption (ADR 010)
# Generate key with: python -c "import secrets; print(secrets.token_urlsafe(32))"
STORAGE_ENCRYPTION_METHOD={{ storage_encryption_method | default('none') }}
STORAGE_ENCRYPTION_KEY={{ storage_encryption_key | default('') }}
STORAGE_ENCRYPTION_KEY_ID={{ storage_encryption_key_id | default('1') }}
